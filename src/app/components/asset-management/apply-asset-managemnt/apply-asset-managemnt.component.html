<div class="container-fluid">
    <div class="d-flex align-items-center mt-2">
        <div class="m-2">
            <div class="h-size"><em class="fa fa-user"></em> <strong> Apply Asset</strong></div>
        </div>
        <div class="flex-fill">
        </div>
        <div class="m-3"><input class="form-control rounded-pill py-2 border-right-0 border" type="search"
                placeholder="search" id="example-search-input" [(ngModel)]="searchModel" (keyup)="getAppliedAssets()">
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <table class="table table-bordered table-hover table-sm">
                <thead class="t-head">
                    <tr>
                        <th *ngFor="let head of headers"><a>{{head}}</a></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let data of assetList | paginate: {
                        itemsPerPage: itemsPerPage,
                        currentPage: currentPage,
                        totalItems: totalItems
                      };let i=index">
                        <td>{{data.assetCategoryId.assetName}}</td>
                        <td>{{data.assetCode}}</td>
                        <td>{{data.assetName}}</td>
                        <td>{{data.assetOwner}}</td>
                        <td>{{data.resourceName}}</td>
                        <td>{{data.description}}</td>
                        <td>{{data.purchaseDate | date:'dd-MM-yyyy'}}</td>
                        <td>{{data.price}}</td>
                        <td>{{data.brand}}</td>
                        <td>{{data.modelno}}</td>
                        <td>{{data.expDate | date:'dd-MM-yyyy'}}</td>
                        <td>{{data.quantity}}</td>
                        <td>
                            <span *ngFor="let doc of data.documents">
                                <a class="action" title="File Downlaod" (click)="viewDocument(doc, data)"><i
                                        class="fa fa-download" aria-hidden="true"></i></a>&nbsp;
                            </span>
                        </td>
                        <td>
                            <a title="Add File" data-toggle="modal" data-target="#add-files"
                                (click)="addFileClick(data)" class="icon-margin"><i class='fas fa-file-upload'></i></a>
                            <a title="View" (click)="modelShowView(data)" class="icon-margin"><i
                                    class="fa fa-eye"></i></a>
                            <a title="Edit" (click)="modelShowEdit(data)" class="icon-margin"><i
                                    class="fas fa-user-edit"></i></a>
                            <a title="Delete" class="icon-margin" mwlConfirmationPopover [popoverTitle]="popoverTitle"
                                [popoverMessage]="popoverMessage" placement="left"
                                (confirm)="delete(data.assetId)" (cancel)="cancelClicked = true"><span
                                    class="fas fa-trash"></span></a>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="row" *ngIf="totalElements!=0">
                <div class="col-md-6 col-sm-6 col-6"><span class="show-entry">Showing
                        <span>{{showingFrom}} to {{showingTo}} of {{totalElements}} entries</span></span>&nbsp;
                </div>

                <div class="col-md-6" *ngIf="totalItems > 0">
                    <pagination-controls (pageChange)="pageChanged($event)"></pagination-controls>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <button type="button" class="btn btn-primary btn-sm" (click)="modelShow()" data-toggle="modal"
                data-target="#applyPopup">
                <i class="fas fa-user-plus"></i> Add
            </button>
        </div>
    </div>
</div>
<div class="modal fade common-model" id="applyPopup">
    <div class="modal-dialog modal-xl">
        <div class="modal-content model">
            <form [formGroup]="assetForm" (ngSubmit)="submit()">
                <!-- Modal Header -->
                <div class="modal-header">
                    <div class="modal-title" *ngIf="!isForViewAndSubmitDisabled"><i class="fas fa-plus"></i>/ <i
                            class="fas fa-edit ml-1"></i> Apply/Update Asset
                    </div>
                    <div class="modal-title" *ngIf="isForViewAndSubmitDisabled"><i class="fa fa-eye"></i> View Asset
                    </div>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <div class="row col-12 padding-field-bottom">
                        <div class="col-1">
                            <label for="type">Asset Category<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <select class="form-control" id="assetCategoryId" formControlName="assetCategoryId"
                                (change)="changeCategory()"
                                [ngClass]="{ 'is-invalid': submitted && form_.assetCategoryId.errors }">
                                <option [ngValue]="null" selected disabled>Select Asset Category </option>
                                <option *ngFor="let asset of assetCategories" [value]="asset.assetId">
                                    {{asset.assetCode}}-{{asset.assetName}}
                                </option>
                            </select>
                            <span class="color-red" *ngIf="submitted && form_.assetCategoryId.errors">Asset Category
                                {{requiredErrorText}}</span>
                        </div>
                        <div class="col-1">
                            <label>Asset Code</label>
                        </div>
                        <div class="col-3">
                            <input type="text" class="form-control" placeholder="Please Enter Asset Code"
                                formControlName="assetCode">
                        </div>
                        <div class="col-1">
                            <label>Asset Name<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <input type="text" class="form-control" placeholder="Please Enter Asset Name"
                                formControlName="assetName"
                                [ngClass]="{ 'is-invalid': submitted && form_.assetName.errors }">
                            <span class="color-red" *ngIf="submitted && form_.assetName.errors">Asset Name
                                {{requiredErrorText}}</span>
                        </div>
                    </div>
                    <div class="row col-12 padding-field-bottom">
                        <div class="col-1">
                            <label for="type">Asset Owner<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <select class="form-control" id="assetOwner" formControlName="assetOwner"
                                (change)="changeOwner()"
                                [ngClass]="{ 'is-invalid': submitted && form_.assetOwner.errors }">
                                <option [ngValue]="null" selected disabled>Select Asset Owner </option>
                                <option *ngFor="let assetOwner of assetOwners" [value]="assetOwner">
                                    {{assetOwner}}
                                </option>
                            </select>
                            <span class="color-red" *ngIf="submitted && form_.assetOwner.errors">Asset Owner
                                {{requiredErrorText}}</span>
                        </div>
                        <div class="col-1" *ngIf="showOwnerEmployee">
                            <label for="type">{{ownerName}}<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3" *ngIf="showOwnerEmployee">
                            <ng-multiselect-dropdown [placeholder]="'Please Select Member'"
                                [disabled]="isForViewAndSubmitDisabled" [settings]="dropdownSettings" [data]="resources"
                                [(ngModel)]="selectedItems" [ngModelOptions]="{standalone: true}"
                                (onSelect)="onItemSelect($event)" (onSelectAll)="onSelectAll($event)"
                                (onDeSelectAll)="onDeSelectAll($event)" (onDeSelect)="onItemDeSelect($event)">
                            </ng-multiselect-dropdown>
                            <span class="color-red" *ngIf="submitted && selectedItems.length == 0">{{ownerName}}
                                {{requiredErrorText}}</span>
                        </div>
                        <div class="col-1">
                            <label>Purchase Date<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <input type="text" formControlName="purchaseDate" bsDatepicker
                                placeholder="Please Select Date"
                                [ngClass]="{ 'is-invalid': submitted && form_.purchaseDate.errors }" [minDate]="now"
                                readonly [bsConfig]="{ isAnimated: true, dateInputFormat: 'DD-MM-YYYY' }" bsDatepicker
                                (bsValueChange)="onPurchaseDateValueChange($event)" placement="bottom"
                                class="text form-control pull-top-5" maxlength="50" />
                            <span class="color-red" *ngIf="submitted && form_.purchaseDate.errors">Purchase Date
                                {{requiredErrorText}}</span>
                        </div>
                    </div>
                    <div class="row col-12 padding-field-bottom">
                        <div class="col-1">
                            <label>Price<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <input type="text" [ngClass]="{ 'is-invalid': submitted && form_.price.errors }"
                                class="form-control" placeholder="Please Enter Price" formControlName="price">
                            <span class="color-red" *ngIf="submitted && form_.price.errors">Price
                                {{requiredErrorText}}</span>
                        </div>
                        <div class="col-1">
                            <label>Brand<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <input type="text" [ngClass]="{ 'is-invalid': submitted && form_.brand.errors }"
                                class="form-control" placeholder="Please Enter Brand" formControlName="brand">
                            <span class="color-red" *ngIf="submitted && form_.brand.errors">Brand
                                {{requiredErrorText}}</span>
                        </div>
                        <div class="col-1">
                            <label>Model No<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <input type="text" [ngClass]="{ 'is-invalid': submitted && form_.modelno.errors }"
                                class="form-control" placeholder="Please Enter Model No" formControlName="modelno">
                            <span class="color-red" *ngIf="submitted && form_.modelno.errors">Model No
                                {{requiredErrorText}}</span>
                        </div>
                    </div>
                    <div class="row col-12 padding-field-bottom">
                        <div class="col-1">
                            <label>Mfg. Date<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <input type="text" formControlName="mfgDate" bsDatepicker placeholder="Please Select Date"
                                [ngClass]="{ 'is-invalid': submitted && form_.mfgDate.errors }" readonly [maxDate]="now"
                                [bsConfig]="{ isAnimated: true, dateInputFormat: 'DD-MM-YYYY' }" bsDatepicker
                                (bsValueChange)="onMfgDateValueChange($event)" placement="bottom"
                                class="text form-control pull-top-5" maxlength="50" />
                            <span class="color-red" *ngIf="submitted && form_.mfgDate.errors">Mfg. Date
                                {{requiredErrorText}}</span>
                        </div>
                        <div class="col-1">
                            <label>Sl No<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <input type="text" class="form-control" placeholder="Please Enter Serial No"
                                formControlName="slno" [ngClass]="{ 'is-invalid': submitted && form_.slno.errors }">
                            <span class="color-red" *ngIf="submitted && form_.slno.errors">Sl No
                                {{requiredErrorText}}</span>
                        </div>
                        <div class="col-1">
                            <label>Exp. Date<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <input type="text" formControlName="expDate" bsDatepicker
                                placeholder="Please Select Expiry Date"
                                [ngClass]="{ 'is-invalid': submitted && form_.expDate.errors }"
                                [minDate]="selectedMfgDate" readonly
                                [bsConfig]="{ isAnimated: true, dateInputFormat: 'DD-MM-YYYY' }" bsDatepicker
                                (bsValueChange)="onExpDateValueChange($event)" placement="bottom"
                                class="text form-control pull-top-5" maxlength="50" />
                            <span class="color-red" *ngIf="submitted && form_.expDate.errors">Exp. Date
                                {{requiredErrorText}}</span>
                        </div>
                    </div>
                    <div class="row col-12 padding-field-bottom">
                        <div class="col-1">
                            <label for="type">Quantity<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <select class="form-control" id="quantity" formControlName="quantity"
                                (ngModelChange)="changeType()"
                                [ngClass]="{ 'is-invalid': submitted && form_.quantity.errors }">
                                <option [ngValue]="null" selected disabled>Select Quantity </option>
                                <option *ngFor="let quantity of quantities" [value]="quantity">
                                    {{quantity}}
                                </option>
                            </select>
                            <span class="color-red" *ngIf="submitted && form_.quantity.errors">Quantity
                                {{requiredErrorText}}</span>
                        </div>
                        <div class="col-1">
                            <label for="type">Mainte-nance<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <select class="form-control" id="maintenance" formControlName="maintenance"
                                [ngClass]="{ 'is-invalid': submitted && form_.maintenance.errors }">
                                <option [ngValue]="null" selected disabled>Select Maintenance </option>
                                <option *ngFor="let maintenance of maintenances" [value]="maintenance">
                                    {{maintenance}}
                                </option>
                            </select>
                            <span class="color-red" *ngIf="submitted && form_.maintenance.errors">Maintenance
                                {{requiredErrorText}}</span>
                        </div>
                        <div class="col-1">
                            <label>Description<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3">
                            <input type="text" class="form-control" placeholder="Please Enter Description"
                                formControlName="description"
                                [ngClass]="{ 'is-invalid': submitted && form_.description.errors }">
                            <span class="color-red" *ngIf="submitted && form_.description.errors">Description
                                {{requiredErrorText}}</span>
                        </div>
                    </div>
                    <div class="row col-12 padding-field-bottom">
                        <div class="col-1" *ngIf="!fileSelected">
                            <label>Add Attachment<span class="color-red">*</span></label>
                        </div>
                        <div class="col-3" *ngIf="!fileSelected">
                            <input type="file" formControlName="selectedFile" class="form-control height-45"
                                (change)="onFileChanged($event)">
                            <span class="color-red"
                                *ngIf="submitted && (selectedFile == '' || selectedFile == undefined) && !fileSelected">Attachment
                                {{requiredErrorText}}</span>
                        </div>
                    </div>
                    <hr>
                    <div class="row" *ngIf="!isForViewAndSubmitDisabled">
                        <div class="col-md-6 pull-left">
                            <button type="submit" id="btnComponentSave" [disabled]="submitProcessing"
                                class="button btn-primary btn-style"><i class="fas fa-save"></i>
                                {{submitText}} <i class="fa fa-spinner fa-spin" *ngIf="submitProcessing"
                                    style="font-size:19px"></i></button>
                        </div>
                        <div class="col-md-6 pull-right" *ngIf="submitText == 'Save & Send for Approval'">
                            <button type="button" id="btnComponentSave" (click)="clear()"
                                class="button btn-warning btn-style" [disabled]="submitProcessing">
                                Clear</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal alert-modal fade" id="donwload_doc" role="dialog" style="display: none;">
    <div class="modal-dialog modal-md">
        <div class="modal-content model">
            <div class="modal-header " id="msg_header">
                <h4 class="modal-title">Download</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="row col-12 padding-field-bottom">
                    <div class="col-2">
                        <label>File Name:</label>
                    </div>
                    <div class="col-10">
                        {{document.fileName}}
                    </div>
                </div>
                <hr>
                <div class="row col-12 padding-field-bottom">
                    <button type="button" target="_blank"
                        (click)="downloadDocumentAttachment(document.filePath, document.fileName)"
                        class="button btn-primary btn-style">Downlaod</button>
                    <button type="button" (click)="deleteDoc(document.fileName)" class="button btn-warning btn-style">
                        Delete</button>
                    <button type="button" class="button btn-danger btn-style" data-dismiss="modal">
                        Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal alert-modal fade" id="add-files" role="dialog" style="display: none;">
    <div class="modal-dialog modal-md">
        <div class="modal-content model">
            <div class="modal-header " id="msg_header">
                <h4 class="modal-title">Upload</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="row col-12 padding-field-bottom">
                    <div class="col-4">
                        <label>Asset Name<span class="color-red">* </span></label>
                    </div>
                    <div class="col-8">
                        <input type="text" class="form-control" placeholder="Please Enter Loan Name"
                            value="{{assetName}}" readonly>
                    </div>
                </div>
                <div class="row col-12 padding-field-bottom">
                    <div class="col-4">
                        <label>Add Attachment <span class="color-red">* </span></label>
                    </div>
                    <div class="col-8">
                        <input type="file" [(ngModel)]="selectedFile1" class="form-control height-45"
                            (change)="onFileChanged1($event)">
                        <span class="color-red"
                            *ngIf="submitted1 && (selectedFile1 == '' || selectedFile1 == undefined)">Attachment
                            {{requiredErrorText}}</span>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-6 pull-left">
                        <button type="button" id="btnComponentSave" [disabled]="submitProcessing" (click)="addFile()"
                            class="button btn-primary btn-style"><i class="fas fa-save"></i>
                            Save <i class="fa fa-spinner fa-spin" *ngIf="submitProcessing"
                                style="font-size:19px"></i></button>
                    </div>
                    <div class="col-md-6 pull-right">
                        <button type="button" id="btnComponentSave" (click)="clear1()"
                            class="button btn-warning btn-style" [disabled]="submitProcessing">
                            Clear</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>