<div class="container-fluid">
    <div class="d-flex align-items-center mt-2">
        <div class="m-2">
            <div class="h-size"><em class="fa fa-user"></em> <strong>Apply Loan/Advance</strong></div>
        </div>
        <div class="flex-fill">
        </div>
        <!-- <div class="m-3"><input class="form-control rounded-pill py-2 border-right-0 border" type="search"
                placeholder="search" id="example-search-input" [(ngModel)]="searchModel" (ngModelChange)="search()">
        </div> -->
    </div>

    <div class="row">
        <div class="col-md-12">
            <table class="table table-bordered table-hover table-sm">
                <thead class="t-head">
                    <tr>
                        <th *ngFor="let head of headers2"><a>{{head}}</a></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let employee of employees2">
                        <td>{{employee.loanOrAdvType}}</td>
                        <td>{{employee.loanTypeId.loanName}}</td>
                        <td>{{employee.appliedDate}}</td>
                        <td>{{employee.budgetLimit}}</td>
                        <td>{{employee.loanAmount}}</td>
                        <td>{{employee.emiCalculatedField}}</td>
                        <td>{{employee.installmentMonths}}</td>
                        <td>{{employee.startrecoveryfrom.year}} - {{employee.startrecoveryfrom.month}}</td>
                        <td>{{employee.status}}</td>
                        <td>{{employee.purpose}}</td>
                        <td>
                            <span *ngFor="let doc of employee.documents">
                                <a class="action" title="File Downlaod" (click)="viewDocument(doc, employee)"><i
                                        class="fa fa-download" aria-hidden="true"></i></a>&nbsp;
                            </span>
                        </td>
                        <td>
                            <button class="action" title="Add File" data-toggle="modal" data-target="#add-files"
                                (click)="addFileClick(employee)">Add File</button> &nbsp;
                            <span *ngIf="!employee.approvalStatus" ><a title="Edit" (click)="modelShowEdit(employee)" class="icon-margin"><i
                                    class="fas fa-user-edit"></i></a></span>
                            <a title="Delete" class="icon-margin" mwlConfirmationPopover [popoverTitle]="popoverTitle"
                                [popoverMessage]="popoverMessage" placement="left"
                                (confirm)="delete(employee.employeeLoanAdvanceId)" (cancel)="cancelClicked = true"><span
                                    class="fas fa-trash"></span></a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <button type="button" class="btn btn-primary btn-sm" (click)="modelShow()" data-toggle="modal"
                data-target="#employeeModelPopup">
                <i class="fas fa-user-plus"></i> Add
            </button>
        </div>
    </div>
</div>
<div class="modal fade common-model" id="employeeModelPopup">
    <div class="modal-dialog modal-xl">
        <div class="modal-content model">
            <form [formGroup]="loanForm" (ngSubmit)="submit()">
                <!-- Modal Header -->
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-plus"></i>/ <i class="fas fa-edit ml-1"></i> Apply
                        Loan/Advance
                    </div>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <div class="row col-12 padding-field-bottom">
                        <div class="col-6 radio-font padd-right-0">
                            <span><input id="deny" class="radio-size" name="loanAdvType" type="radio" value="Loan"
                                    [(ngModel)]="loanAdvType" [ngModelOptions]="{standalone: true}"
                                    (ngModelChange)="handleType('Loan')" style="cursor: pointer;" checked>
                                <label>&nbsp;Loan</label></span>&nbsp;
                            <span><input id="approve" class="radio-size" name="loanAdvType" type="radio" value="Advance"
                                    style="cursor: pointer;" [(ngModel)]="loanAdvType"
                                    [ngModelOptions]="{standalone: true}" (ngModelChange)="handleType('Advance')">
                                <label>&nbsp;Advance</label></span>
                        </div>
                        <div class="col-2">
                            <label for="type">Type<span class="color-red">*</span></label>
                        </div>
                        <div class="col-4">
                            <select class="form-control" [(ngModel)]="loanType" id="loanType" formControlName="loanType"
                                (ngModelChange)="changeType(loanType)" (change)="checkValidation()"
                                [ngClass]="{ 'is-invalid': submitted && form_.loanType.errors }">
                                <option [ngValue]="null" selected disabled>Select Loan Type </option>
                                <option *ngFor="let loanType of loanTypes" [value]="loanType.loanId">
                                    {{loanType.loanName}}
                                </option>
                            </select>
                            <span class="color-red" *ngIf="submitted && form_.loanType.errors">Loan Type
                                {{requiredErrorText}}</span>
                        </div>
                    </div>
                    <div class="row col-12 padding-field-bottom">
                        <div class="col-2">
                            <label for="type">Applied Date<span class="color-red">*</span></label>
                        </div>
                        <div class="col-4">
                            <input type="text" formControlName="appliedDate" bsDatepicker
                                placeholder="Please Select Date"
                                [ngClass]="{ 'is-invalid': submitted && form_.appliedDate.errors }" [minDate]="now"
                                readonly [bsConfig]="{ isAnimated: true, dateInputFormat: 'DD-MM-YYYY' }" bsDatepicker
                                (bsValueChange)="onAppliedDateValueChange($event)" placement="bottom"
                                class="text form-control pull-top-5" maxlength="50" />
                            <span class="color-red" *ngIf="submitted && form_.appliedDate.errors">Applied Date
                                {{requiredErrorText}}</span>
                        </div>
                        <div class="col-2">
                            <label>Budget Limit</label>
                        </div>
                        <div class="col-4">
                            <input type="text" class="form-control" placeholder="Please Enter Budget Limit"
                                formControlName="budgetLimit" (ngModelChange)="handleAmountReqValidation()" readonly>
                        </div>
                    </div>
                    <div class="row col-12 padding-field-bottom">
                        <div class="col-2">
                            <label for="type">Amount Required<span class="color-red">*</span></label>
                        </div>
                        <div class="col-4">
                            <input type="number" class="form-control" placeholder="Please Enter Amount Required"
                                formControlName="amountRequired" [min]="1" [max]="99999999999999"
                                (ngModelChange)="changeTennureMonths(installmentMonths)">
                            <span class="color-red" *ngIf="submitted && form_.amountRequired.errors">Amount Required
                                {{requiredErrorText}}<br></span>
                            <span class="color-red" *ngIf="amountRequiredIsValid">Amount Required can't be more than
                                Budget Limit}<br></span>
                            <span class="color-red" *ngIf="submitted && isAmountInValid">Amount Required
                                should not be negative value</span>
                        </div>
                        <div class="col-2">
                            <label for="type">Installments Opted<span class="color-red">*</span></label>
                        </div>
                        <div class="col-4">
                            <select class="form-control" [(ngModel)]="installmentMonths" id="installmentMonths"
                                formControlName="installmentMonths"
                                (ngModelChange)="changeTennureMonths(installmentMonths)">
                                <option [ngValue]="null" selected disabled>Select Installments Opted </option>
                                <option *ngFor="let tenure of tenures" [value]="tenure">{{tenure}}</option>
                            </select>
                            <span class="color-red" *ngIf="submitted && form_.installmentMonths.errors">Installments
                                Opted
                                {{requiredErrorText}}</span>
                        </div>
                    </div>
                    <div class="row col-12 padding-field-bottom">
                        <div class="col-2">
                            <label for="type">EMI<span class="color-red">*</span></label>
                        </div>
                        <div class="col-4">
                            <input type="text" class="form-control" placeholder="Please Enter EMI"
                                formControlName="emiCalculatedField" readonly>
                            <span class="color-red" *ngIf="submitted && form_.emiCalculatedField.errors">EMI
                                {{requiredErrorText}}</span>
                        </div>
                        <div class="col-2">
                            <label>Work Period</label>
                        </div>
                        <div class="col-4 row padd-right-0">
                            <div class="col-6 padd-right-0">
                                <input type="text" class="form-control" placeholder="Please Enter Work Period Year"
                                    formControlName="workPeriodyear" readonly>
                            </div>
                            <div class="col-6 padd-right-0">
                                <input type="text" class="form-control" placeholder="Please Enter Work Period Month"
                                    formControlName="workPeriodMonth" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="row col-12 padding-field-bottom">
                        <div class="col-2">
                            <label for="type">Status<span class="color-red">*</span></label>
                        </div>
                        <div class="col-4">
                            <!-- <select class="form-control" [(ngModel)]="status" id="status" formControlName="status"> -->
                            <select class="form-control" id="status">
                                <option [ngValue]="null" selected disabled>Select Status </option>
                                <option value="Active" selected>Active </option>
                                <!-- <option *ngFor="let status of statusList" [value]="status">{{status}}</option> -->
                            </select>
                            <span class="color-red" *ngIf="submitted && form_.status.errors">Status
                                {{requiredErrorText}}</span>
                        </div>
                        <div class="col-2">
                            <label>Start Recovery From<span class="color-red">*</span></label>
                        </div>
                        <div class="col-4 row padd-right-0">
                            <div class="col-6 padd-right-0">
                                <select id="year" class="form-control" [(ngModel)]="year" formControlName="year">
                                    <option [ngValue]="null" selected disabled>Select year </option>
                                    <option *ngFor="let year of years" [value]="year">{{year}}</option>
                                </select>
                                <span class="color-red" *ngIf="submitted && form_.year.errors">Year
                                    {{requiredErrorText}}</span>
                            </div>
                            <div class="col-6 padd-right-0">
                                <select id="month" class="form-control" [(ngModel)]="month" formControlName="month">
                                    <option [ngValue]="null" selected disabled>Select Month </option>
                                    <option *ngFor="let month of months" [value]="month">{{month}}</option>
                                </select>
                                <span class="color-red" *ngIf="submitted && form_.month.errors">Month
                                    {{requiredErrorText}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="row col-12 padding-field-bottom">
                        <div class="col-2">
                            <label>Purpose</label>
                        </div>
                        <div class="col-4">
                            <input type="text" [(ngModel)]="purpose" formControlName="purpose"
                                placeholder="Please Enter Purpose" class="form-control form-control-sm" id="purpose">
                        </div>
                        <div class="col-2" *ngIf="!fileSelected">
                            <label>Add Attachment <span class="color-red">* </span></label>
                        </div>
                        <div class="col-4" *ngIf="!fileSelected">
                            <input type="file" formControlName="selectedFile" class="form-control height-45"
                                (change)="onFileChanged($event)">
                            <span class="color-red"
                                *ngIf="submitted && (selectedFile == '' || selectedFile == undefined) && !fileSelected">Attachment
                                {{requiredErrorText}}</span>
                        </div>
                    </div>
                    <hr>
                    <div class="row" *ngIf="isSubmitDisabled">
                        <b class="color-red">{{submitErrorText}}</b>
                    </div>
                    <div class="row" *ngIf="!isLoanTypeApplicable">
                        <b class="color-red">Please change the Loan Type as you are present in the Approval Workflow for the loan type type selected</b>
                    </div>
                    <div class="row" *ngIf="!isSubmitDisabled">
                        <div class="col-md-6 pull-left">
                            <button type="submit" id="btnComponentSave" [disabled]="submitProcessing"
                                class="button btn-primary btn-style"><i class="fas fa-save"></i>
                                {{submitText}} <i class="fa fa-spinner fa-spin" *ngIf="submitProcessing"
                                    style="font-size:19px"></i></button>
                        </div>
                        <div class="col-md-6 pull-right" *ngIf="submitText == 'Save'">
                            <button type="button" id="btnComponentSave" (click)="clear()"
                                class="button btn-warning btn-style" [disabled]="submitProcessing">
                                Clear</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal alert-modal fade" id="donwload_doc" role="dialog" style="display: none;">
    <div class="modal-dialog modal-md">
        <div class="modal-content model">
            <div class="modal-header " id="msg_header">
                <h4 class="modal-title">Download</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="row col-12 padding-field-bottom">
                    <div class="col-2">
                        <label>File Name:</label>
                    </div>
                    <div class="col-10">
                        {{document.fileName}}
                    </div>
                </div>
                <hr>
                <div class="row col-12 padding-field-bottom">
                    <button type="button" target="_blank"
                        (click)="downloadDocumentAttachment(document.filePath, document.fileName)"
                        class="button btn-primary btn-style">Downlaod</button>
                    <button type="button" (click)="deleteDoc(document.fileName)" class="button btn-warning btn-style">
                        Delete</button>
                    <button type="button" class="button btn-danger btn-style" data-dismiss="modal">
                        Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal alert-modal fade" id="add-files" role="dialog" style="display: none;">
    <div class="modal-dialog modal-md">
        <div class="modal-content model">
            <div class="modal-header " id="msg_header">
                <h4 class="modal-title">Upload</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="row col-12 padding-field-bottom">
                    <div class="col-4">
                        <label>Loan Type And Name<span class="color-red">* </span></label>
                    </div>
                    <div class="col-8">
                        <input type="text" class="form-control" placeholder="Please Enter Loan Name"
                            value="{{loanTypeName}}" readonly>
                    </div>
                </div>
                <div class="row col-12 padding-field-bottom">
                    <div class="col-4">
                        <label>Add Attachment <span class="color-red">* </span></label>
                    </div>
                    <div class="col-8">
                        <input type="file" [(ngModel)]="selectedFile1" class="form-control height-45"
                            (change)="onFileChanged1($event)">
                        <span class="color-red"
                            *ngIf="submitted1 && (selectedFile1 == '' || selectedFile1 == undefined)">Attachment
                            {{requiredErrorText}}</span>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-6 pull-left">
                        <button type="button" id="btnComponentSave" [disabled]="submitProcessing" (click)="addFile()"
                            class="button btn-primary btn-style"><i class="fas fa-save"></i>
                            Save <i class="fa fa-spinner fa-spin" *ngIf="submitProcessing"
                                style="font-size:19px"></i></button>
                    </div>
                    <div class="col-md-6 pull-right">
                        <button type="button" id="btnComponentSave" (click)="clear1()"
                            class="button btn-warning btn-style" [disabled]="submitProcessing">
                            Clear</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>